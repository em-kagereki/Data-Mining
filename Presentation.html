<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Explainable artificial intelligence model to predict mortality in patients with suspected acute coronary syndrome</title>
    <meta charset="utf-8" />
    <meta name="author" content="Edwin Kagereki" />
    <script src="libs/header-attrs-2.11/header-attrs.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
    <link rel="stylesheet" href="style.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Explainable artificial intelligence model to predict mortality in patients with suspected acute coronary syndrome
## MIMIC III ANALYSIS
### Edwin Kagereki
### 2021/09/20 (Presented: 2021-11-26)

---





# Outline

 - Back ground
 - Data Understanding
 - Data Preparation
 - Modeling
 - Evaluation
 - Deployment

---
# Acute Coronary Syndrome (ACS) 

- Cardiovascular diseases (CVDs) are the leading cause of global mortality.
- Prediction of prognosis model for patients with suspected ACS is important in critical care medicine.
- Syndromes Suggestive of Ischemia or Infarction is a term given to diverse presentations related to cardiomyopathies of sudden onset.

- Terms commonly used in the diagnosis of acute coronary syndrome and the related differential diagnosis include:

*"stemi","acute coronary syndrome","angina","tachycardia","aortic aneurysm","pericardi","ortic dissection","coronary artery dissection","cardiomyopathy","heart failure","mitral valve disease","mitral stenosis","coronary artery disease","chf","congestive heart failure","heart failure","telemetry","myocardial infaction","cardiac arrest","myocardial infarction","aortic stenosis","st elevated","pericardial effusion", "cardiomyopathy","cath lab","tamponade","tamponede"*


---
# Proactively making clinical decisions.
- Prediction of risk for untoward outcomes may help clinicians chose the type and intensity of therapy.

&lt;img src="workflow1.PNG" width="800" height="430" style="display: block; margin: auto;" /&gt;


.footnote[[*]  [ACLS guideline](https://www.acls.net/images/algo-acs.pdf)]


---
# MIMIC-III database

- Freely-available database comprising deidentified health related data from 46,520 patients who stayed in critical care units of the Beth Israel Deaconess Medical Center between 2001 and 2012.

- Pre-requisite for data access:
1. Become a credentialed user on PhysioNet after completion of a training course in human
subjects research.
2. Sign the data data usage agreement.

- All data was collected downloaded  to  PostgreSQL database. 

- Loinc data tables were used to enrich the data. [Loinc tables](https://loinc.org/downloads/)]

---

## Objectives

The aim of the project was:

 - Build a binary classifier to predict all-cause mortality of patients based on demographics and interventions within first hour of suspected ACS event.
 
- Identify and describe variations in care pathway between patients who died and those who
survived.

This was achieved by:

- Developing a risk-prediction **machine learning classifier**, focusing on clinical end point of all-cause
mortality after one hour of treatment(golden hour).
- Explanation of the predicted outcome based on the care pathway using process mining. This AHA guideline(ACLS 2020) will was used as the gold standard for ACS workflow`*`.

.footnote[[*]  [ACLS guideline](https://www.acls.net/images/algo-acs.pdf)]

---
# Data Mining

- Data access and exploration
- Data Preparation
- Model building and tuning
- Process mining.
---
class: full
# Data access

- After connecting to the PostgreSQL database,  SQL queries were made using the R dplyr interface. The following tables were collected:

&lt;img src="database.PNG" width="800" height="430" style="display: block; margin: auto;" /&gt;


---
# Summary of study population



---
# Data exploration


![](Presentation_files/figure-html/unnamed-chunk-4-1.png)&lt;!-- --&gt;


---
class: .full


```
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
```

&lt;img src="Presentation_files/figure-html/unnamed-chunk-5-1.png" width="100%" style="display: block; margin: auto;" /&gt;



---
class: full

&lt;img src="Presentation_files/figure-html/unnamed-chunk-6-1.png" width="80%" height="80%" style="display: block; margin: auto;" /&gt;

---

# Diagnosis


```r
# http://loiyumba.github.io/2016-08-01-eurocup2016vis/
```


---
# Data preparation

1. Data cleaning.

2. Data transformation  and merging.

3. Derived variables

4. Categorical variable encoding.

5. Normalization.

6. Dimension reduction
---
# Data cleaning

Missing values
.pull-left[
1. Patient ID was used where admission ID was missing.

2. Missing *ETHNICITY* and *MARITAL_STATUS*  was replaced with *UNKNOWN* 

]
Data formatting
.pull-right[
- Deletion of irrelevant word - Example *rule/out*, *status post*

 - Modifying  incorrect, incomplete, irrelevant, duplicated, or improperly formatted data.

Example of diagnosis:
`$$3VD
\begin{cases} 
\text{3 vessel cad} \\
\text{3 vessel coronary artery disease}\\
\text{three vessel coronary artery disease}\\
\text{3 vessel diagnosis}\\
\text{3 vessel disease}
\end{cases}$$`
]



---
# Data enrichment 
Done by appending the collected data with relevant context obtained from additional sources.

- Data on drugs enriched with drug formularly: BNF

- Laboratory drugs enhanced with the Loinc table

---
# Data transformation




Data was transformed from the narrow format to the wide format.


Step 1: Aggregation by Admission ID




Step 2: Split into multiple columns




---
class: full

# Derived variables

Some considerations were done
.pull-left[
Age
1. Computed by subtracting the *DOB* from the *ADMITTIME*.

2. Values above 300 was adjusted by subtracting 211.
]

.pull-right[
Datetime Features

1. Day of the year;

2. Week of the year;

3. Month;

4. Year

5. Hour of the day;

]

---

# Categorical variable encoding

All the  categorical variables were converted into numerical variables.

.pull-left[
Variables with high cardinality
1. Diagnosis.

2. Medication.

]

.pull-right[
Variables with less cardinality but need to preserve the variance
1. Language;

2. Tribe;

]

.footnote[[*] Not really. See next page.]

Final dataset had
---
# Dimension reduction





---


--- 
# Spliting

&lt;img src="splitting.PNG" width="800" height="430" style="display: block; margin: auto;" /&gt;


---
# Performance metric

.pull-left[


|                  	|          	| Patient outcome 	                     	|
|:----------------:	|----------	|:-------------------:	|:-------------------:	|
|                  	|          	| Dead            	| Survive            	|
| Predicted outcome 	| Dead 	| true positive (tp) 	| false positive (fp) 	|
|                  	| Survive 	| false negative (fn) 	|  true negative (tn) 	|

]

.pull-right[

- The aim of the model was to maximize the identification of the patients at the highest risk of death (tp). 
- F-beta measure  was used ( set at 2 to give less weight to precision and more weight to recall)
`$$Recall =  \frac{TP}{TP+FN}$$`
`$$Precision =  \frac{TP}{TP+FP}$$`
`$$F-score =  2*\frac{Recall*Precision}{Precision+Recall}$$`

]




---
# Candidate models

To initiate the process the following candidate models were chosen

- Regression based: Logistic regression, Linear discriminant,SVM 
- Decision trees: Random forests, Gradient boosting.
- Kernel based: k-Nearest neighbor.
- Information based: Naive Bayes.
- Quadratic discriminant analysis.

Now we can use our validation set (k folds) to estimate the performance of our models using the fit_resamples() function to fit the models on each of the folds and store the results.

- The metrics used were

---

# Model tuning 

- Grid search algorithm was used to train multiple  models simultaneously.
- Space-filling design to tune,  25 candidate models simultaneoulsy.

---
class: full

&lt;img src="Presentation_files/figure-html/unnamed-chunk-12-1.png" width="80%" height="80%" style="display: block; margin: auto;" /&gt;


---

# Determining the most appropriate cut-off value


---
# Selected model 


---
class: full
# Processes


---
# Variance in pathways:(Activity and throughput time)

All the  categorical variables were converted into numerical variables.
---
class: .full
# Variance in pathways

.pull-left[
Alive

&lt;img src="Alive.PNG" width="260" height="400" style="display: block; margin: auto;" /&gt;

]

.pull-right[
Dead
&lt;img src="Dead.PNG" width="260" height="400" style="display: block; margin: auto;" /&gt;
]

---




---
# Limitations

- The data pre-processing may be a hindrance in model deployment - data encoding, PCA.

- Random shifting of event dates may have an impact on the temporal sequence of the events.

- Limited computation capacity thus more experiments were not run - dimension reduction(UMAP, t-SNE), Neural networks. 

 
---
# Conclusion

- Successful extraction, loading and transformation of data from the MIMIC-III database.

- Run data cleaning (text editing) data pre-processing (encoding (hash and frequency encoding), principal component analysis).

- Built a machine learning classifier to predict all-cause mortality of the patients suspected to have acute cardiac syndrome.

- Identified potential root causes of the patient outcome.
---

class: center, middle

# Thanks!

Slides created via the R package [**xaringan**](https://github.com/yihui/xaringan).

The chakra comes from [remark.js](https://remarkjs.com), [**knitr**](https://yihui.org/knitr/), and [R Markdown](https://rmarkdown.rstudio.com).
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"fig_crop": false,
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
